name: CI - Check Links

on:
  pull_request:
    types: [opened, synchronize]

permissions:
  contents: read
  pull-requests: write

jobs:
  lychee:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - uses: actions/cache@v4
        with:
          path: .lycheecache
          key: cache-lychee-${{ github.sha }}
          restore-keys: cache-lychee-

      - uses: lycheeverse/lychee-action@5c4ee84814c983aa7164eaee476f014e53ff3963 # v2.5.0
        with:
          args: "--verbose --no-progress --cache --max-cache-age 1d docs/"
          fail: true

      - name: Add output as PR comment
        uses: embrace-io/actions-comment-pull-request@v2
        with:
          comment_tag: lychee
          filePath: lychee/out.md
