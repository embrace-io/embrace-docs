name: CI - Check Links

on:
  pull_request:
    types: [opened, synchronize]

permissions:
  contents: read
  pull-requests: write

jobs:
  lychee:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5

      - uses: actions/cache@v4
        with:
          path: .lycheecache
          key: cache-lychee-${{ github.sha }}
          restore-keys: cache-lychee-

      - uses: lycheeverse/lychee-action@885c65f3dc543b57c898c8099f4e08c8afd178a2 # v2.6.1
        with:
          args: "--verbose --no-progress --cache --max-cache-age 1d docs/"
          fail: true

      - run: sed -i 's/Summary/Summary - Link Checker/' lychee/out.md

      - name: Add output as PR comment
        uses: embrace-io/actions-comment-pull-request@v3
        with:
          comment_tag: lychee
          filePath: lychee/out.md
